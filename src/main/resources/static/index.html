<!doctype html>
<html>


<head>
	<link rel="stylesheet" type="text/css" href="style.css">
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
	<title>Phtoography</title>
	<meta name="description" content="Acest articol este important si bine scris">
	<meta http-equiv="content-type" content="text/html;charset=UTF-8">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
</head>

<body>


	<div class="city">

		<header>
			<h1>Photography is art</h1>
		</header>
		<div class="continut">
			<div class="coloanaDreapta">
				<div class="loginnDIV" style="display:none;">
					<form action="./" id="login-form" method="GET">
						<div class="row">
							<label for="username">Username:</label>
							<input type="text" class="aux" id="username" name="username"><br><br>
						</div>
						<div class="row">
							<label>Password:</label>
							<input type="password" class="aux" id="password" name="password"><br><br>
						</div>
						<div class="row">
							<input type="submit" class="login_button" id="btn_login" name="login" value="Login">
						</div>
					</form>
					<div class="container">
						<div class="row">
							<div class="row">
								<div class="col-md-4 col-md-offset-4">
									<div class="panel panel-default">
										<div class="panel-body">
											<div class="text-center">
												<h3><i class="fa fa-lock fa-4x"></i></h3>
												<h2 class="text-center">Forgot Password?</h2>
												<p>You can reset your password here.</p>
												<div class="panel-body">
													<form class="form" action="./" id="recover" method="GET">
														<fieldset>
															<div class="form-group">
																<div class="input-group">
																	<span class="input-group-addon"><i class="glyphicon glyphicon-envelope color-blue"></i></span>
																	<input id="emailInput" placeholder="email address" class="aux" type="email" oninvalid="setCustomValidity('Please enter a valid email address!')"
																	 onchange="try{setCustomValidity('')}catch(e){}" required="">
																	<input type="password" placeholder="new password" class="aux" id="pass_res" name="pass"><br><br>
																</div>
															</div>
															<div class="form-group">
																<input class="login_button" value="Send My Password" type="submit">
															</div>
														</fieldset>
													</form>

												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="istoricDIV" style="display:none;">
					<!--<form action="./" id="validate-form" method="GET">-->
						<!--<label for="token">token:</label>-->
						<!--<input type="text" class="aux" id="token" name="token"><br><br>-->
						<!--<input type="submit" class="login_button" id="btn_val" name="val" value="Validate">-->
					<!--</form>-->
				</div>

				<div class="SIGNUPDIV" style="display:none;">
					<form action="./" id="signup-form" method="GET">
						<label>Username:</label>
						<input type="text" class="aux" id="user" name="user"><br><br>
						<label for="pass">Password:</label>
						<input type="password" class="aux" id="pass" name="pass"><br><br>
						<div class="row">
							<label for="text">Type of account:</label>
							<select class="dropdown" id="drp_tip" style="width: 300px">
								<option value="fotograf" class="dropdown-content">fotograf</option>
								<option value="user" class="dropdown-content">user</option>
							</select>
						</div>
						<label for="email">Email: </label>
						<input type="text" class="aux" id="mail" name="mail"><br><br>
						<input type="submit" class="login_button" id="btn_signup" name="SINGUP" value="SignUP">
					</form>
				</div>

				<div class="PRIMA_PAGINA">
					<p id="avem"> Not logged in </p>
					<p id="initial_text"> WELCOME! </p>
					<iframe width="854" height="480" src="https://www.youtube.com/embed/8TbWgwBz2EI" allowfullscreen></iframe>
					<p id="ordine_link"> </p>
					<p id="most_mouse"> </p>
				</div>

				<div class="uploadDiv" style="display:none;">
					<form id="upload-image"  method="post" enctype="multipart/form-data">
						<div class="row">
							<label     style="...">Select Your Image
								<input type="file" id="file_id" name="file"  required />
							</label>
						</div>
						<div class="row">
							<label for="token">price:</label>
							<input type="text" class="aux" id="price" name="price"><br><br>
						</div>
						<br/>
						<input type="submit" value="Upload"  class="login_button"/>
					</form>
				</div>

				<div id="chatDiv" style="display:none;">

					<nav id="div_chat">
						<ul id="lista_chat" class="liista">

						</ul>
					</nav>

					<form id="chat-Form" method="post" action="./">
						<input id="chatText" name="chatText" maxlength="255" class="aux" />
						<input type="submit" class="login_button" value="Semd" />
					</form>

				</div>




				<div class="cartDiv" style="display:none;">
					<table   class="t1" id="tabek">
                        <caption>Your cart</caption>

                        <thead>
						<tr>
							<th scope="col">ID Poza</th>
							<th scope="col">Autor</th>
							<th scope="col">Pret</th>
						</tr>
						</thead>
						<tbody id="hh">
						<tr>
							<th scope="row"></th>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						</tbody>
					</table>

<style type="text/css">

  table.t1 {
    margin: 1em auto;
    border-collapse: collapse;
    font-family: Arial, Helvetica, sans-serif;
  }
  .t1 th, .t1 td {
    padding: 4px 8px;
  }
  .t1 thead th {
    background: #4f81bd;
    text-transform: lowercase;
    text-align: left;
    font-size: 15px;
    color: #fff;
  }
  .t1 tr {
    border-right: 1px solid #95b3d7;
  }
  .t1 tbody tr {
    border-bottom: 1px solid #95b3d7;
  }
  .t1 tbody tr:nth-child(odd) {
    background: #dbe5f0;
  }
  .t1 tbody th, .t1 tbody tr:nth-child(even) td {
    border-right: 1px solid #95b3d7;
  }
  .t1 tfoot th {
    background: #4f81bd;
    text-align: left;
    font-weight: normal;
    font-size: 10px;
    color: #fff;
  }
  .t1 tr *:nth-child(3), .t1 tr *:nth-child(4) {
    text-align: right;
  }

</style>

<style>
                    table#tabek {
                    width: 100%;
                    background-color: #eee;
                    }

</style>

					<form id="cart-form"  method="get" enctype="multipart/form-data">
						<label for="token">Enter ID for removing photo:</label>
						<input type="text" class="aux" id="del_from" name="price"><br><br>
						<input type="submit" value="Remove"  class="login_button"/>
					</form>
				</div>


			<div class="cartDivBuy" style="display:none;">
				<table style="width:100%"class="t1" id="tabek1">
					<caption>Your cart</caption>

					<thead>
					<tr>
						<th scope="col">ID Poza</th>
						<th scope="col">Autor</th>
						<th scope="col">Pret</th>
					</tr>
					</thead>
					<tbody id="hh2">
					<tr>
						<th scope="row"></th>
						<td></td>
						<td></td>
						<td></td>
					</tr>
					</tbody>
				</table>
<style>
 table#tabek1 {
                    width: 100%;
                    background-color: #eee;
                    }
</style>

			<form id="buy-from-cart-form"  method="get" enctype="multipart/form-data">

				<input type="submit" value="Buy"  class="login_button"/>
				</form>
			</div>




				<div class="principalDIV" style="display:none;">
					<article id="principal">
						<header>
							<p id="n_foto">Nume Fotograf</p>
						</header>
						<div class="eLogat" style="display:none;">'
							<p id="cacat1"> Not logged in </p>
						</div>



						<img class="mySlides" id="imageID" src="titlu.jpg" alt="Poza">

						<button class="butoane" id="b_stanga"> > </button>
						<button class="butoane" id="b_dreapta"> &lt; </button>


						<p class="Comment"> Poza Curenta</p>


						<button type="button" id="showFeed" class="feed"> ShowFeedback </button>
						<div class="show_feed" style="display:none;">
							<header>
								<h3>Feedback</h3>
							</header>

							<nav>
								<ul id="lista_feed">

								</ul>
							</nav>


							<div class="feedback" style="display:none;">
								<div class="stars">
									<form action="./" id="to_reset_form">
										<input class="star star-5" id="star-5" type="radio" name="star" />
										<label class="star star-5" for="star-5"></label>
										<input class="star star-4" id="star-4" type="radio" name="star" />
										<label class="star star-4" for="star-4"></label>
										<input class="star star-3" id="star-3" type="radio" name="star" />
										<label class="star star-3" for="star-3"></label>
										<input class="star star-2" id="star-2" type="radio" name="star" />
										<label class="star star-2" for="star-2"></label>
										<input class="star star-1" id="star-1" type="radio" name="star" />
										<label class="star star-1" for="star-1"></label>
										<input id="comment1" type="text" name="comm" />
									</form>

									<button type="button" id="addFeedback" class="feed"> Add FeedBack </button>
								</div>
							</div>
						</div>
					</article>
				</div>
			</div>
			<div class="coloanaStanga">
				<select class="dropdown" id="drp">
				<option value="menu" class="dropdown-content">Menu</option>
                <option value="main" class="dropdown-content">MainPage</option>
			</select>


				<div class="butoane">

					<button type="button" id="myPhotos" class="myPhotosButtonas">Fotografiile mele</button>
					<button type="button" id="addImg"> Adauga Imagini</button>
					<button type="button" id="chat"> Chat</button>
					<button type="button" id="signUp">Register</button>
					<button type="button" id="valBut">Validate</button>
					<button type="button" id="logIn">LogIn</button>
					<button type="button" id="logOut">LogOut</button>
					<button type="button" id="getCart">GetCart</button>
					<button type="button" id="buyPhoto">Buy Photos</button>

				</div>
				<script>
					$.ajaxSetup({
						cache: false
					});
					$(document).ready(function () {
						$("#lista_feed").empty();
						current_user = "none";
						var array_photos = [];
						var array_clicked = [];
						var index = 0;
						var last_p = "none";
						var div_princ = 0;
						var div_chat = 0;
						var div_login = 0;
						var div_addimg = 0;
						var div_main = 0;


						function myDisplay() {
							$("#lista_feed").empty();
							var form_data = new FormData();

							form_data.append("fotog", array_photos[index]);

							$.ajax
								({
									url: "show_feedback.php", // Url to which the request is send
									type: "POST",             // Type of request to be send, called as method
									data: form_data, // Data sent to server, a set of key/value pairs (i.e. form fields and values)
									contentType: false,       // The content type used when sending data to the server.
									cache: false,             // To unable request pages to be cached
									processData: false,        // To send DOMDocument or non processed data file it is set to false
									success: function (data)   // A function to be called if request succeeds
									{
										if (data != "Nu") {
											var obj = $.parseJSON(data);
											var arrayLength = obj.feedback.length;
											for (var i = 0; i < arrayLength; i++) {

												var ul = document.getElementById("lista_feed");
												var li = document.createElement("li");
												var a = document.createElement("article");
												var head = document.createElement("header");
												var hh = document.createElement("h4");
												var par = document.createElement("p");
												head.textContent = obj.feedback[i].user + "  said:";
												hh.textContent = "		   Rated at:" + obj.feedback[i].stele;
												par.textContent = obj.feedback[i].comm;


												head.appendChild(hh);
												a.appendChild(head);
												a.append(par);
												li.appendChild(a);
												ul.appendChild(li);
											}
										}
										$(".show_feed").show();

									},


								});
						}


						$("#logIn").click(function () {
							$(".show_feed").hide();
							$(".loginnDIV").show();
							$(".principalDIV").hide();
							$(".SIGNUPDIV").hide();
							$(".uploadDiv").hide();
							$(".PRIMA_PAGINA").hide();
							$(".show_feed").hide();
							$("#chatDiv").hide();
							$(".istoricDIV").hide();
							$(".cartDiv").hide();
							$(".cartDivBuy").hide();


						});

						$("#istoric").click(function () {
							$(".show_feed").hide();
							$(".loginnDIV").hide();
							$(".principalDIV").hide();
							$(".SIGNUPDIV").hide();
							$(".uploadDiv").hide();
							$(".PRIMA_PAGINA").hide();
							$(".show_feed").hide();
							$("#chatDiv").hide();
							$(".istoricDIV").show();
							$(".cartDiv").hide();
							$(".cartDivBuy").hide();

							displayHistory();
						});

						$("#signUp").click(function () {
							$(".show_feed").hide();
							$(".loginnDIV").hide();
							$(".principalDIV").hide();
							$(".SIGNUPDIV").show();
							$(".uploadDiv").hide();
							$(".PRIMA_PAGINA").hide();
							$(".show_feed").hide();
							$("#chatDiv").hide();
							$(".istoricDIV").hide();
							$(".cartDiv").hide();
							$(".cartDivBuy").hide();


						});

						$("#buyPhoto").click(function () {
							$.ajax({
								type: "GET",
								url: "/seeCart/"+current_user,
								success: function (response) {
									if (response.succes == "false") {
									}
									else {
										function loadTable(tableId, fields, data) {
											//$('#' + tableId).empty(); //not really necessary
											var rows = '';

											$.each(data, function(index, item) {
												var row = '<tr>';
												$.each(fields, function(index, field) {
													row += '<td>' + item[field+''] + '</td>';
												});
												rows += row + '<tr>';
											});
											$('#' + tableId).html(rows);
										}
										loadTable('hh2', ['id', 'username', 'price'], response.cart);



									}


								},

								});
							$(".show_feed").hide();
							$(".loginnDIV").hide();
							$(".principalDIV").hide();
							$(".SIGNUPDIV").hide();
							$(".uploadDiv").hide();
							$(".PRIMA_PAGINA").hide();
							$(".show_feed").hide();
							$("#chatDiv").hide();
							$(".validateDIV").hide();
							$(".validateDIV").hide();
							$(".cartDiv").hide();
							$(".cartDivBuy").show();
						});


							$("#buy-from-cart-form").submit(function (e) {

							$.ajax({
								type: "GET",
								url: "/buy/"+current_user,
								success: function (response) {
									if (response.succes == "false") {
										alert(response.error);
										console.log("Recieved authentication error");
										$("p#cacat1").text("Not logged in");
									}
									else {
										console.log("Recieved authentication success");
										current_user = username;
										var textul = "Logged in as " + username;
										$("p#avem").text(textul);
										$(".loginnDIV").hide();
										$(".principalDIV").hide();
										$(".uploadDiv").hide();
										$(".SIGNUPDIV").hide();
										$(".feedback").hide();
										$(".PRIMA_PAGINA").hide();
										$(".show_feed").hide();
										$("#chatDiv").hide();
										$(".validateDIV").hide();
										alert("You have bought everything from your cart, " + username + "!");
										var x = document.getElementById ("hh2");
										hh2.refresh();

									}

									$("#buy-from-cart-form")[0].reset();
								},

							});
							return false;
						});






							$("#getCart").click(function () {
							$.ajax({
								type: "GET",
								url: "/seeCart/"+current_user,
								success: function (response) {
									if (response.succes == "false") {
									}
									else {
										function loadTable(tableId, fields, data) {
											//$('#' + tableId).empty(); //not really necessary
											var rows = '';

											$.each(data, function(index, item) {
												var row = '<tr>';
												$.each(fields, function(index, field) {
													row += '<td>' + item[field+''] + '</td>';
												});
												rows += row + '<tr>';
											});
											$('#' + tableId).html(rows);
										}
										loadTable('hh', ['id', 'username', 'price'], response.cart);


									}


								},

								});
							$(".show_feed").hide();
							$(".loginnDIV").hide();
							$(".principalDIV").hide();
							$(".SIGNUPDIV").hide();
							$(".uploadDiv").hide();
							$(".PRIMA_PAGINA").hide();
							$(".show_feed").hide();
							$("#chatDiv").hide();
							$(".validateDIV").hide();
							$(".validateDIV").hide();
							$(".cartDivBuy").hide();
							$(".cartDiv").show();
						});

						$("#cart-form").submit(function (e) {
							$("#lista_feed").empty();
							id = $("input#del_from.aux").val();

							$.ajax({
								type: "GET",
								url: "/removeFromCart/"+id+"/"+current_user,
								success: function (response) {
									if (response.succes == "false") {
										alert("For some reason, this item could not be removed from cart");

									}
									else {
										console.log("Recieved authentication success");
										current_user = username;
										var textul = "Logged in as " + username;
										$("p#avem").text(textul);
										$(".loginnDIV").hide();
										$(".principalDIV").hide();
										$(".uploadDiv").hide();
										$(".SIGNUPDIV").hide();
										$(".feedback").hide();
										$(".PRIMA_PAGINA").hide();
										$(".show_feed").hide();
										$("#chatDiv").hide();
										$(".validateDIV").hide();
										alert("You have suvccessfully removed item with id " + id + "!");
									}
									$("#cart-form")[0].reset();
								},

							});
							return false;
						});


						$("#login-form").submit(function (e) {
							$("#lista_feed").empty();
							username = $("input#username.aux").val();
							password = $("input#password.aux").val();

							$.ajax({
								type: "GET",
								url: "/login",
								data: {
									username: username,
									password: password
								},
								success: function (response) {
									if (response.succes == "false") {
										alert(response.error);
										console.log("Recieved authentication error");
										$("p#cacat1").text("Not logged in");
									}
									else {
										console.log("Recieved authentication success");
										current_user = username;
										var textul = "Logged in as " + username;
										$("p#avem").text(textul);
										$(".loginnDIV").hide();
										$(".principalDIV").hide();
										$(".uploadDiv").hide();
										$(".SIGNUPDIV").hide();
										$(".feedback").show();
										$(".PRIMA_PAGINA").show();
										$(".show_feed").hide();
										$("#chatDiv").hide();
										$(".istoricDIV").hide();
										alert("Welcome, " + username + "!");
									}
									$("#login-form")[0].reset();
								},

							});
							return false;
						});

						$("#recover").submit(function (e) {
							$("#lista_feed").empty();
							email = $("input#emailInput").val();
							password = $("input#pass_res").val();
							$.ajax({
								type: "GET",
								url: "/recover",
								data: { email: email, password: password },
								success: function (response) {
									if (response.success == "false") {
										alert(response.error);
										console.log("The email entered is not valid");
										$("p#cacat1").text("Not logged in");
									}
									else {
										alert("Your can be reset by clicking the link received on email");
										console.log("You can recover your password via email");
									}
									$("#login-form")[0].reset();
									$("#recover")[0].reset();
								},

							});
							return false;
						});

                    function displayHistory() {
							$("#lista_feed").empty();

							$.ajax({
								type: "GET",
								url: "/getHistory",
								data: { username: current_user },
								success: function (response) {
									if (response.success == "false") {
										$(".istoricDIV").text(response.error);
									}
									else {
									    $('.istoricDIV').empty();
                                        var table = $('<table>');
                                        table.css("width", "100%");
                                        table.css("border", "1px solid black");
                                        var table_header = $('<tr>');
                                        table_header.css("border", "1px solid black");
                                        var col1 = $('<th>').text("DATE");
                                        var col2 = $('<th>').text("QUANTITY");
                                        var col3 = $('<th>').text("PRICE");
                                        col1.css("border", "1px solid black");
                                        col2.css("border", "1px solid black");
                                        col3.css("border", "1px solid black");
                                        table_header.append(col1);
                                        table_header.append(col2);
                                        table_header.append(col3);
                                        table.append(table_header);
                                        jQuery.each(response.transactions, function() {
                                            var row = $('<tr>');
                                            row.css("border", "1px solid black");
                                            var td1 = $('<td>').text(this.time);
                                            var td2 = $('<td>').text(this.quantity);
                                            var td3 = $('<td>').text(this.price);
                                            td1.attr('align', 'center');
                                            td2.attr('align', 'center');
                                            td3.attr('align', 'center');
                                            td1.css("border", "1px solid black");
                                            td2.css("border", "1px solid black");
                                            td3.css("border", "1px solid black");
                                            row.append(td1);
                                            row.append(td2);
                                            row.append(td3);
                                            table.append(row);
                                        });
                                        $('.istoricDIV').append(table);
									}
									$("#login-form")[0].reset();
									$("#signup-form")[0].reset();
								},

							});
							return false;
						}

						$("#signup-form").submit(function (e) {
							$("#lista_feed").empty();
							username = $("input#user.aux").val();
							password = $("input#pass.aux").val();
							type = $("#drp_tip").val();
							mail = $("input#mail.aux").val();
							$.ajax({
								type: "GET",
								url: "/register",
								data: {
									username: username,
									password: password,
									type: type,
									email: mail
								},
								success: function (response) {
									if (response.success == "false") {
										alert(response.error);
										console.log("Recieved singup error");
									}
									else {
										console.log("Recieved singup success");
										var textul = "Registration succes. You should receive token for validation via email";
										alert(textul);
										$(".loginnDIV").hide();
										$(".principalDIV").hide();
										$(".uploadDiv").hide();
										$(".SIGNUPDIV").hide();
										$(".feedback").hide();
										$(".PRIMA_PAGINA").show();
										$(".show_feed").hide();
										$("#chatDiv").hide();
										$(".istoricDIV").hide();
										$(".cartDiv").hide();

									}
									$("#login-form")[0].reset();
									$("#signup-form")[0].reset();
								},

							});
							return false;
						});

						$("#addImg").click(function () {
							$(".show_feed").hide();
							$(".loginnDIV").hide();
							$(".principalDIV").hide();
							$(".SIGNUPDIV").hide();
							$(".uploadDiv").show();
							$(".PRIMA_PAGINA").hide();
							$(".show_feed").hide();
							$("#chatDiv").hide();
							$(".istoricDIV").hide();
							$(".cartDiv").hide();
							$(".cartDivBuy").hide();

						});


						$("#logOut").click(function (e) {
							e.preventDefault();
							alert("User has logged out")
							var logout1 = "logout";
							current_user = "none";
							array_clicked = [];
							var textul = "Not logged in";
							$("p#avem").text(textul);
							$(".loginnDIV").hide();
							$(".principalDIV").hide();
							$(".uploadDiv").hide();
							$(".SIGNUPDIV").hide();
							$(".feedback").hide();
							$(".PRIMA_PAGINA").hide();
							$(".show_feed").hide();
							$("#chatDiv").hide();
							$(".istoricDIV").hide();
							$(".PRIMA_PAGINA").show();
							$(".cartDiv").hide();
							$(".cartDivBuy").hide();


							$.ajax({
								type: "GET",
								url: "/logout",
								data: {username: username},
								success: function (response) {
									alert("User has logged out");
								},

							});
						});


							$("#addImg").click(function () {
							$(".show_feed").hide();
							$(".loginnDIV").hide();
							$(".principalDIV").hide();
							$(".SIGNUPDIV").hide();
							$(".uploadDiv").show();
							$(".PRIMA_PAGINA").hide();
							$(".show_feed").hide();
							$("#chatDiv").hide();
							$(".istoricDIV").hide();
							$(".cartDiv").hide();
							$(".cartDivBuy").hide();


						});

						 $("#upload-image").submit(function (e)
						 {
					 		var file_data = $("#file_id").prop("files")[0];
					 		var price = $("#price").val();
							var form_data = new FormData();
                        	form_data.append("file", file_data);
    						form_data.append("username", current_user);
    						form_data.append("price", price);
							$.ajax({
	    						url: "/addPicture", // Url to which the request is send
								type: "POST",             // Type of request to be send, called as method
								data: form_data, // Data sent to server, a set of key/value pairs (i.e. form fields and values)
        						processData: false,
        						contentType:false,
								success: function (data)   // A function to be called if request succeeds
								{
									$("#upload-image")[0].reset();
								},
								async: false
						  });
						  return false;
						});

					});
				</script>

				<div class="listaFotografi">

					<nav>
						<ul id="lista1">
						</ul>
					</nav>
				</div>
			</div>
		</div>
	</div>
	<footer>
		<p> Copyright All rights reserved to everyone on Earth</p>
	</footer>

</body>

</html>